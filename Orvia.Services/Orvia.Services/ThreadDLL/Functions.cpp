#include "pch.h"

#include "Functions.h"

/////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////// WriteInDebugFile //////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////

int WriteInDebugFile(std::string _line, std::string _pathDebugFile) {

    int ret; 

    std::ofstream file;

    struct tm newtime;
    __time32_t aclock;

    char buffer[32];
    errno_t errNum;

    std::string delimiterDate = " ::: ";

    _time32( &aclock ); 

    _localtime32_s( &newtime, &aclock ); 

    errNum = asctime_s(buffer, 32, &newtime);

    file.open(_pathDebugFile, std::ios::out | std::ios::ate | std::ios::app);

    if (file.is_open())
    {

        ret = 1;

        file << buffer + delimiterDate + _line + '\n';

        file.close();

    } else ret = 0;

    return ret;

}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////// _gettimeofday //////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////

int _gettimeofday(struct timeval* p, void* tz) {

    ULARGE_INTEGER ul; // As specified on MSDN.
    FILETIME ft;

    // Returns a 64-bit value representing the number of
    // 100-nanosecond intervals since January 1, 1601 (UTC).
    GetSystemTimeAsFileTime(&ft);

    // Fill ULARGE_INTEGER low and high parts.
    ul.LowPart = ft.dwLowDateTime;
    ul.HighPart = ft.dwHighDateTime;
    // Convert to microseconds.
    ul.QuadPart /= 10ULL;
    // Remove Windows to UNIX Epoch delta.
    ul.QuadPart -= 11644473600000000ULL;
    // Modulo to retrieve the microseconds.
    p->tv_usec = (long)(ul.QuadPart % 1000000LL);
    // Divide to retrieve the seconds.
    p->tv_sec = (long)(ul.QuadPart / 1000000LL);

    return 0;

}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////